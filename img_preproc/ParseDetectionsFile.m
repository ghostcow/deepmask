function [detections] = ParseDetectionsFile(filePath)
% parsing detections file, generated by AlignDataset.m
% file format - [image_path],[aligned_image_path],[detection 4D vector]
% return map object where each key is aligned image path (trimming the base
%   path before figure name), and value is struct with the original image
%   path and the detection
detections = containers.Map; 
fid = fopen(filePath);
C = textscan(fid, '%s %s %s', 'Delimiter', ',');
fclose(fid);
imagePaths = C{1};
alignedImagePaths = C{2};
detectionsVecs = C{3};
nImages = length(imagePaths);

for iDetection = 1:nImages
    % cut aligned image path and save only [figure_name]/[image_name]
    alignedImagePath = alignedImagePaths{iDetection};
    if strncmp(computer, 'GLNXA', 5)
        % linux system
        alignedImagePath = strrep(alignedImagePath, '\', '/');
    end
    
    [temp, alignedImageName, ext1] = fileparts(alignedImagePath);
    [~, figureName, ext2] = fileparts(temp);
    % NOTE : if the figure name has dots than it's considered as ext
    key = fullfile([figureName ext2], [alignedImageName ext1]);
    % convert ' ' to '_'
    key = strrep(key, ' ', '_');
    
    % parse detections string
    detectionVec = sscanf(detectionsVecs{iDetection}, '%f %f %f %f');
    
    if isKey(detections, key)
        fprintf('warninf - duplicate key = %s\n', key);
    end
    detections(key) = struct('path', strrep(imagePaths{iDetection}, ' ', '_'), ...
        'detection', detectionVec);
end


end
